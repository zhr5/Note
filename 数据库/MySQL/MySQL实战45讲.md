# 基础篇

## 基础架构

![image-20231127165204802](images/MySQL实战45讲/image-20231127165204802.png)

## 日志系统

![image-20231127165813084](images/MySQL实战45讲/image-20231127165813084.png)

### 一条sql的执行过程

![img](images/MySQL实战45讲/db-mysql-sql-14.png)

- 首先执行器根据 MySQL 的执行计划来查询数据，先是从缓存池中查询数据，如果没有就会去数据库中查询，如果查询到了就将其放到缓存池中
- 在数据被缓存到缓存池的同时，会写入 undo log 日志文件
- 更新的动作是在 BufferPool 中完成的，同时会将更新后的数据添加到 redo log buffer 中
- 完成以后就可以提交事务，在提交的同时会做以下三件事 
  - 将redo log buffer中的数据刷入到 redo log 文件中
  - 将本次操作记录写入到 bin log文件中
  - 将 bin log 文件名字和更新内容在 bin log 中的位置记录到redo log中，同时在 redo log 最后添加 commit 标记

至此表示整个更新事务已经完成

------

著作权归@pdai所有 原文链接：https://pdai.tech/md/db/sql-mysql/sql-mysql-execute.html

## 索引

![image-20231127191627090](images/MySQL实战45讲/image-20231127191627090.png)

![image-20231127193539017](images/MySQL实战45讲/image-20231127193539017.png)

**跳表、LSM 树？**

### 索引维护

由于每个非主键索引的叶子节点上都是主键的值。如果用身份证号做主键，那么每个二级索引的叶子节点占用约 20 个字节，而如果用整型做主键，则只要 4 个字节，如果是长整型（bigint）则是 8 个字节。显然，主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小。所以，从性能和存储空间方面考量，自增主键往往是更合理的选择。

### 覆盖索引

### 最左前缀原则

在建立联合索引的时候，如何安排索引内的字段顺序？

这里我们的评估标准是，索引的复用能力。因为可以支持最左前缀，所以当已经有了 (a,b) 这个联合索引后，一般就不需要单独在 a 上建立索引了。因此，第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的。

### 索引下推

索引下推一定是在联合索引的情况下，根据联合索引本身就有的数据直接做一次过滤，而不用再进行多次无用的回表再到Server层进行过滤