- 基本概念

  - Producer：生产者。向主题发布新消息的应用程序。

  - Consumer：。从主题订阅新消息的应用程序。

  - Broker:Kafka集群

  - Record：消息。Kafka是消息引擎嘛，这里的消息就是指Kafka处理的主要对象。

  - Topic：主题。主题是承载消息的逻辑容器，在实际使用中多用来区分具体的业务。

  - Partition：分区。一个有序不变的消息序列。每个topic下可以有多个分区。

  - Offset：消息位移。表示分区中每条消息的位置信息，是一个单调递增且不变的值。

  - Replica：副本。Kafka中同一条消息能够被拷贝到多个地方以提供数据冗余，这些地方就是所谓的副本。副本还分为领导者副本和追随者副本，各自有不同的角色划分。副本是在分区层级下的，即每个分区可配置多个副本实现高可用。

  - Consumer Offset：消费者位移。表征消费者消费进度，每个消费者都有自己的消费者位移。1.从 0.9 版本开始， consumer 默认将 offset 保存在 Kafka 一个内置的topic 中，该 topic 为 __consumer_offsets。2. Kafka0.9 版本之前， consumer 默认将 offset 保存在 Zookeeper 中。

  - Consumer Group：消费者组。多个消费者实例共同组成的一个组，同时消费多个分区以实现高吞吐。

  - Rebalance ：重平衡。消费者组内某个消费者实例挂掉后，其他消费者实例自动重新分配订阅主题分区的过程。Rebalance是Kafka消费者端实现高可用的重要手段。

  - ISR : In-Sync Replicas (同步副本集),可以理解为与leader保持同步的所有副本的集合

  - AR :一个分区的所有副本集合叫做AR (Assigned Repllicas)

  - OSR : 与leader-replica未能保持同步的副本集叫做OSR (Out-Sync Relipcas)

  - LEO :LEO（log end offset） 称为日志末端位移，代表日志文件中下一条待写入消息的 offset，这个 offset 上实际是没有消息的,分区 ISR 集合中的每个副本（所有的 leader 和 follower 副本）都会维护自身的 LEO。当 leader 副本收到生产者的一条消息，LEO 通常会自增 1，而 follower 副本需要从 leader 副本 fetch 到数据后，才会增加它的 LEO。

  - HW : ISR 集合中最小的 LEO 即为分区的 HW，消费者只能读取到小于高水位线以下的消息，即成功复制到所有副本的最后一条消息。因此，对于同一个副本对象，其高水位值不会大于 LEO 值。

- 优点

  - 高吞吐量、低延迟

    - 消息发送

      - 批量发送

      - 异步发送

      - 消息压缩

      - 并行发送

    - 消息存储
    
      - 零拷贝：减少内核态到用户态的拷贝，磁盘通过sendfile实现**DMA** 拷贝Socket buffer
      - 顺序磁盘读写：充分利用磁盘顺序读写的超高性能
      - **页缓存mmap** ：将磁盘文件**映射**到内存, 用户通过修改内存就能修改磁盘文件。
      - 稀疏索引：分段日志文件，每个分段分别有索引文件，每隔一定数量的消息建立一个索引点，而不是对分段中的每条消息都建立索引
      - 分区和副本：
    
    - 消息消费
      - 消费者组
      - 并行消费
      - 批量拉取
    

- **应用场景**

- **日志收集：**用Kafka可以收集各种服务的Log，通过大数据平台进行处理；
- **消息系统：**解耦生产者和消费者、缓存消息等；
- **用户活动跟踪：Kafka经常被用来记录Web用户或者App用户的各种活动，如浏览网页、搜索、点击等活动，这些活动信息被各个服务器发布到Kafka的Topic中，然后消费者通过订阅这些Topic来做运营数据**的实时的监控分析，也可保存到数据库



